<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10: Qualtrics and Labelled Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="10_qtrics_draft_files/libs/clipboard/clipboard.min.js"></script>
<script src="10_qtrics_draft_files/libs/quarto-html/quarto.js"></script>
<script src="10_qtrics_draft_files/libs/quarto-html/popper.min.js"></script>
<script src="10_qtrics_draft_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="10_qtrics_draft_files/libs/quarto-html/anchor.min.js"></script>
<link href="10_qtrics_draft_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="10_qtrics_draft_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="10_qtrics_draft_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="10_qtrics_draft_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="10_qtrics_draft_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="10_qtrics_draft_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="10_qtrics_draft_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">10: Qualtrics and Labelled Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This tutorial will focus on efficient, transparent, and user-friendly techniques for working with data specifically gathered using the <a href="https://www.qualtrics.com/">Qualtrics survey platform</a>. We will cover how to import and work with labelled data from Qualtrics and how to easily produce a data dictionary straight from the dataset itself.</p>
<section id="acknowledgements" class="level3">
<h3 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>This tutorial was co-conceived and co-created with two brilliant PhD researchers, <a href="mailto:haie20@sussex.ac.uk">Hanna Eldarwish</a> and <a href="Joshua.Francis@sussex.ac.uk">Josh Francis</a>, who contributed invaluable input throughout the process of developing the tutorial. This included collecting commonly asked questions and issues with Qualtrics data analysis; discussing the topics to cover and how best to cover them; and testing code and solutions. Hanna Eldarwish also provided the basis for the dataset, collected during her undergraduate dissertation at Sussex under the supervision of <a href="https://profiles.sussex.ac.uk/p323096-vlad-costin">Dr Vlad Costin</a>.</p>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<section id="packages" class="level3">
<h3 class="anchored" data-anchor-id="packages">Packages</h3>
<p>As usual, we will be using {tidyverse}. When {tidyverse} is installed, it also installs the {haven} package, which we will use for data importing. However, {haven} isn’t loaded as part of the core {tidyverse} group of packages, so let’s load it separately. Finally, we will also need the {labelled} package to work with labelled data.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Load the packages.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tibble' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'purrr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'forcats' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lubridate' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'haven' was built under R version 4.3.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'labelled' was built under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjlabelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sjlabelled' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'sjlabelled'

The following objects are masked from 'package:labelled':

    copy_labels, remove_labels, to_character, to_factor, val_labels

The following objects are masked from 'package:haven':

    as_factor, read_sas, read_spss, read_stata, write_sas, zap_labels

The following object is masked from 'package:forcats':

    as_factor

The following object is masked from 'package:dplyr':

    as_label

The following object is masked from 'package:ggplot2':

    as_label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sjPlot' was built under R version 4.3.2</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Today’s dataset focuses on various aspects of meaning in life (MiL), and has been randomly generated based on a real dataset kindly contributed by Hanna Eldarwish and Vlad Costin. All variables have been randomly generated, but they are based on the patterns in the original dataset. The original, bigger dataset will be made available alongside article publication in the future, so keep an eye out for it!</p>
<div class="callout callout-style-default callout-tip callout-titled" title="New File Type">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
New File Type
</div>
</div>
<div class="callout-body-container callout-body">
<p>You might notice that instead of the familiar <code>readr::read_csv()</code>, today we have <code>haven::read_sav()</code>. That’s because the file I’ve prepared is a SAV file, associated with the SPSS statistical analysis programme. The next section explains <em>why</em> we are using this data type, but otherwise, there’s nothing new about these commands.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Read in the <code>mil_data.sav</code> object from the data folder, or alternatively from Github via URL, as you prefer.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>From a folder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/mil_data.sav"</span>) <span class="sc">|&gt;</span> haven<span class="sc">::</span><span class="fu">read_sav</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From URL:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(<span class="st">"https://raw.githubusercontent.com/drmankin/practicum/master/data/mil_data.sav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="codebook" class="level4">
<h4 class="anchored" data-anchor-id="codebook">Codebook</h4>
<p>This codebook is intentionally sparse, because we’ll be generating our own from the dataset in just a moment. This table covers only the questionnaire measures to help you understand the variables.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable Prefix</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Scale</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Subscale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">global_meaning</td>
<td style="text-align: left;">Meaning in Life</td>
<td style="text-align: left;">Global Meaning</td>
</tr>
<tr class="even">
<td style="text-align: left;">mattering</td>
<td style="text-align: left;">Meaning in Life</td>
<td style="text-align: left;">Mattering</td>
</tr>
<tr class="odd">
<td style="text-align: left;">coherence</td>
<td style="text-align: left;">Meaning in Life</td>
<td style="text-align: left;">Coherence</td>
</tr>
<tr class="even">
<td style="text-align: left;">purpose</td>
<td style="text-align: left;">Meaning in Life</td>
<td style="text-align: left;">Purpose</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sym_immortality</td>
<td style="text-align: left;">Symbolic Immortality</td>
<td style="text-align: left;">Single scale</td>
</tr>
<tr class="even">
<td style="text-align: left;">belonging</td>
<td style="text-align: left;">Belonging</td>
<td style="text-align: left;">Single scale</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>&nbsp;</p>
</section>
</section>
</section>
<section id="qualtrics-data" class="level2">
<h2 class="anchored" data-anchor-id="qualtrics-data">Qualtrics Data</h2>
<p><a href="https://www.sussex.ac.uk/its/services/software/qualtrics">Qualtrics</a> is a survey-building tool very commonly used for questionnaire-type studies, as well as some experimental work. The University of Sussex has an institutional licence for Qualtrics, so all staff and students can log in with their Sussex details and easily construct and collaborate on surveys.</p>
<p>For help using Qualtrics itself, the <a href="https://www.qualtrics.com/support/survey-platform/my-projects/my-projects-overview/">Qualtrics support pages</a> are generally excellent. This tutorial will only briefly touch on the options within Qualtrics itself.</p>
<p>Once the study is complete and responses have been collected, you will need to <a href="https://www.qualtrics.com/support/survey-platform/data-and-analysis-module/data/download-data/export-data-overview/">export your data from Qualtrics</a> so that you can analyse it. Qualtrics offers a variety of export data types, including our familiar CSV type. However, we’re going to instead explore a new option: SAV data.</p>
<section id="sav-data" class="level3">
<h3 class="anchored" data-anchor-id="sav-data">SAV Data</h3>
<p>The <code>.sav</code> file type is associated with <a href="https://www.ibm.com/products/spss-statistics">SPSS</a>, a widely used statistical analysis programme. So, why are we using SPSS files when working in R?</p>
<p>Importing via <code>.sav</code> has two key advantages. First, it results in a much cleaner import format. If you try importing the same data via <code>.csv</code> file, you’ll find that you need to do some very fiddly and pointless cleanup first. For instance, the <code>.csv</code> version of the same dataset will introduce some empty rows that have to be deleted with <code>dplyr::slice()</code> or similar. The <code>.sav</code> version of the dataset doesn’t have any comparable formatting issues.</p>
<p>Most importantly, however, importing <code>.sav</code> file types into R with particular packages like {haven} gets us a dataset with a special type of data: namely, labelled data. The labels allow us to preserve important information about the questions asked and response options in Qualtrics, and to (mostly) painlessly create codebooks for datasets. We will explore these features in depth in this tutorial</p>
</section>
<section id="exporting-from-qualtrics" class="level3">
<h3 class="anchored" data-anchor-id="exporting-from-qualtrics">Exporting from Qualtrics</h3>
<p>If you’d like to work with your own study data, you will need to export your data in SAV format from Qualtrics first. To do this, open your Qualtrics survey and select the “Data &amp; Analysis” tab along the top, just under the name of your survey.</p>
<p>In the Data Table view, look to the right-hand side of the screen. Click on the drop-down menu labelled “Export &amp; Import”, then select the first option, “Export Data…”</p>
<p><img src="/images/qtrics_export.png" class="img-fluid" alt="A screenshot the Qualtrics Data &amp; Analysis screen with red boxes indicating the steps to take to export data: Data &amp; Analysis tab, Export &amp; Import menu, and Export Data... option."></p>
<p>In the “Download a data table” menu, choose “SPSS” from the choices along the top. Make sure “Download all fields” is ticked, then click “Download”.</p>
<p><img src="/images/qtrics_spss.png" class="img-fluid" alt="A screenshot the Qualtrics Download a Data Table screen with red boxes indicating the steps to take to export SPSS data: SPSS tab, Download button."></p>
<p>The dataset will download automatically to your computer’s Downloads folder. From there, you should rename it to something sensible and move it into a <code>data</code> folder within your project folder. From there, you can read it in using the <code>here::here() |&gt; haven::read_sav()</code> combo that we saw in the Data section previously.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Sensible Naming Conventions and Folder Structure">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sensible Naming Conventions and Folder Structure
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I know it may not seem like something anyone should care about, but sensible file and folder names will make your life so much easier for working in R (and generally).</p>
<p>For folder structure, make sure you do the following:</p>
<ul>
<li>Always always <em>ALWAYS</em> use an R Project for working in R.</li>
<li>Have a consistent set of folders for each project: for example, <code>images</code>, <code>data</code>, and <code>docs</code>.</li>
<li>Use sub-folders where necessary, but consider using sensible naming conventions instead.</li>
</ul>
<p>For naming conventions, your file name should make it obvious what information it contains and when it was created, <em>especially</em> for datasets like this. Personally, I would prefer longer and more explicit file names over brevity; this is because I prefer to navigate files using R, and that’s <em>much</em> easier using explicit file names than it is with file metadata.</p>
<p>So, for a download like this, I’d probably name it something like <code>qtrics_diss_2023_11_08.sav</code>. The <code>qtrics</code> tells me it’s a Qualtrics export, the <code>diss</code> tells me it’s a dissertation project, and the last bit is the full date in easily machine-readable format. Imagine if I continue to recruit participants and download a new dataset later, say a month from now, and name it <code>qtrics_diss_2023_12_08.sav</code>. I could easily distinguish which dataset was which by the date, but also see that they are different versions of the same thing by their shared prefix.</p>
<p>This is a much more reliable system than calling them, say, <code>Qualtrics output.sav</code> and <code>Dissertation FINAL REAL.sav</code>. This kind of naming “convention” contains no information about which is which or when they were exported, or even that they’re two versions of the same study dataset! It might seem like a small detail at the time, but Future You trying to figure out which dataset to use weeks or months later will feel the difference.</p>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="the-plan" class="level2">
<h2 class="anchored" data-anchor-id="the-plan">The Plan</h2>
<p>Our workflow for this dataset will be slightly different than previously. We’ll start by doing some basic cleanup of the dataset, and produce a codebook, or “data dictionary”, drawing on the label metadata in the SAV file. For the purpose of practice, we’ll also have a look at how to work with those labels, and manage different types of missing values.</p>
<p>As useful as labels are, they will get in the way when we want to work with our dataset further. So, we’ll convert the variables in the dataset into either factors, for categorical data, or numeric, for continuous variables. From that point forward, we can work with the dataset using the techniques and functions we’ve learned thus far.</p>
<p>&nbsp;</p>
</section>
<section id="cleanup-and-data-dictionary" class="level2">
<h2 class="anchored" data-anchor-id="cleanup-and-data-dictionary">Cleanup and Data Dictionary</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most of the following examples are drawn from the <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">“Introduction to labelled” vignette</a> from the {labelled} package. If you want to do something with labelled data that isn’t covered here, that’s a good place to start!</p>
</div>
</div>
<p>Let’s start off by having a look at the dataset. As usual, you can call the dataset or use <code>View()</code> on it directly, but we’re going to take advantage of the new data type to get a more helpful summary, that emulates the “Variable View” in SPSS.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the <code>generate_dictionary()</code> function from the {labelled} packages to create a data dictionary for <code>mil_dict</code>, then pipe it into <code>View()</code>.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  labelled<span class="sc">::</span><span class="fu">generate_dictionary</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 41 × 7
     pos variable            label          col_type missing levels value_labels
   &lt;int&gt; &lt;chr&gt;               &lt;chr&gt;          &lt;chr&gt;      &lt;int&gt; &lt;name&gt; &lt;chr&gt;       
 1     1 StartDate           Start Date     dttm           0 &lt;NULL&gt; ""          
 2     2 EndDate             End Date       dttm           0 &lt;NULL&gt; ""          
 3     3 Status              Response Type  dbl+lbl        0 &lt;NULL&gt; "IP Address…
 4     4 Finished            Finished       dbl+lbl        0 &lt;NULL&gt; "False, Tru…
 5     5 RecordedDate        Recorded Date  dttm           0 &lt;NULL&gt; ""          
 6     6 ResponseId          Response ID    chr            0 &lt;NULL&gt; ""          
 7     7 DistributionChannel Distribution … chr            0 &lt;NULL&gt; ""          
 8     8 UserLanguage        User Language  chr            0 &lt;NULL&gt; ""          
 9     9 english_fluency_1   Please select… dbl+lbl        0 &lt;NULL&gt; "Very well,…
10    10 age                 How old are y… dbl            0 &lt;NULL&gt; ""          
# ℹ 31 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>What we get is a new summary dataset that contains some useful information about each of the variables in <code>mil_data</code>. Along with the actual variable name in the dataset, which we see under <code>variable</code>, we also get the actual question that participants saw in Qualtrics under <code>label</code>, and the response options - where applicable - in <code>value_labels</code>.</p>
<p>Why a data dictionary? There’s two key reasons to do this. First, as we’ve already seen throughout these tutorials, data dictionaries (or “codebooks”) are very useful for understand datasets, even your own. In this case, we’ve generally named our variables usefully in Qualtrics before the export, but if you forget to (or don’t typically) do this, this reference helps you navigate “Q42”, “Q16” etc. The second reason is for other people: if you want to share your data publicly, including a dictionary/codebook is not only a kindness to other users but also helps prevent misuse or misunderstandings.</p>
<p>Before we look at these labels in more depth, we’re first going to address two minor issues that commonly come up with Qualtrics data to make sure our dataset is ready to use.</p>
<section id="renaming-variables" class="level3">
<h3 class="anchored" data-anchor-id="renaming-variables">Renaming Variables</h3>
<p>If you inspected the dataset closely, you might have noticed that one of the items has a strange name: <code>coherence_42</code>, right between <code>coherence_1</code> and <code>coherence_3</code>.</p>
<p>This wasn’t intentional - in the process of creating the questionnaire in Qualtrics, this variable came out with a weird name. It happens more easily than you think! The best-case option would be to update the Qualtrics questionnaire itself before exporting the data, but you may not be able (or want) to do this, so instead, let’s have a quick look at how to rename variables.</p>
<p>As (almost) always, there’s a friendly {dplyr} function to help us with our data wrangling. This time it’s sensibly-named <code>dplyr::rename()</code>, which renames variables using <code>new_name = old_name</code> arguments.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Rename <code>coherence_42</code> to <code>coherence_2</code>. Don’t forget to save this change to the dataset!</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="ot">&lt;-</span> mil_data <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">coherence_2 =</span> coherence_42)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do you have lots of variables to rename? Do you like writing functions, or using regular expressions? Check out <code>rename()</code>’s flashier cousin <code>rename_with()</code>, which uses a function to rename variables.</p>
</div>
</div>
</section>
<section id="separating-columns" class="level3">
<h3 class="anchored" data-anchor-id="separating-columns">Separating Columns</h3>
<p>The second thing I’d like to do doesn’t concern the main dataset, but rather the data dictionary we’ve generated. For the single-item questions, the <code>label</code> column is reasonably helpful. However, the items with a shared prefix all come from the same matrix scale in Qualtrics, and their labels have two parts: the “question text” that usually contains directions about how to respond, and the actual item text for each individual item.</p>
<p>As an example, the label for <code>belonging_1</code> reads:</p>
<blockquote class="blockquote">
<p>Please rate the extent to which these statements apply to you. - When I am with other people, I feel included</p>
</blockquote>
<p>Which corresponds to this in Qualtrics:</p>
<p><img src="/images/b1.png" class="img-fluid" alt="A screenshot of a Qualtrics matrix table of Likert responses, with 'Please rate the extent to which these statements apply to you' at the top, and a single item, 'When I am with others, I feel included' and a rating scale from strongly disagree to strongly agree."></p>
<p>To make the labels more readable, let’s split up the question text, which is repeated for all items on the same subscale and not very useful, and the item text, which contains the specific text of each item. The good news is that the two pieces are defined, or delimited, by the ” - ” symbol that Qualtrics automatically adds to link them.</p>
<p>Since we want to separate the <code>labels</code> column into two - making the dataset wider - using a delimiter, the <code>separate_wider_delim()</code> function from the {tidyr} package should do the trick!</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-1-2" class="code-annotation-target"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>  labelled<span class="sc">::</span><span class="fu">generate_dictionary</span>() <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_wider_delim</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> label,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5" onclick="event.preventDefault();" href="">5</a><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">" - "</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="6" onclick="event.preventDefault();" href="">6</a><span id="annotated-cell-1-6" class="code-annotation-target"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"item_label"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="7" onclick="event.preventDefault();" href="">7</a><span id="annotated-cell-1-7" class="code-annotation-target"><a href="#annotated-cell-1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_few =</span> <span class="st">"align_start"</span></span>
<span id="annotated-cell-1-8"><a href="#annotated-cell-1-8" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-1" data-code-annotation="1">Take the data, <em>and then</em></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-1" data-code-annotation="2">Generate the data dictionary, <em>and then</em></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-1" data-code-annotation="3">Separate wider by delimiter as follows:</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-1" data-code-annotation="4">Separate the <code>label</code> column</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-1" data-code-annotation="5">At the ” - ” delimiter</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="6" data-code-cell="annotated-cell-1" data-code-annotation="6">Into two new columns called “label” and “item_label” respectively</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="7">7</dt>
<dd>
<span data-code-lines="7" data-code-cell="annotated-cell-1" data-code-annotation="7">If there are too few pieces (that is, for the rows where there is no delimiter), fill in values from the start.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 41 × 8
     pos variable          label item_label col_type missing levels value_labels
   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;int&gt; &lt;name&gt; &lt;named list&gt;
 1     1 StartDate         Star… &lt;NA&gt;       dttm           0 &lt;NULL&gt; &lt;NULL&gt;      
 2     2 EndDate           End … &lt;NA&gt;       dttm           0 &lt;NULL&gt; &lt;NULL&gt;      
 3     3 Status            Resp… &lt;NA&gt;       dbl+lbl        0 &lt;NULL&gt; &lt;dbl [12]&gt;  
 4     4 Finished          Fini… &lt;NA&gt;       dbl+lbl        0 &lt;NULL&gt; &lt;dbl [2]&gt;   
 5     5 RecordedDate      Reco… &lt;NA&gt;       dttm           0 &lt;NULL&gt; &lt;NULL&gt;      
 6     6 ResponseId        Resp… &lt;NA&gt;       chr            0 &lt;NULL&gt; &lt;NULL&gt;      
 7     7 DistributionChan… Dist… &lt;NA&gt;       chr            0 &lt;NULL&gt; &lt;NULL&gt;      
 8     8 UserLanguage      User… &lt;NA&gt;       chr            0 &lt;NULL&gt; &lt;NULL&gt;      
 9     9 english_fluency_1 Plea… How well … dbl+lbl        0 &lt;NULL&gt; &lt;dbl [4]&gt;   
10    10 age               How … &lt;NA&gt;       dbl            0 &lt;NULL&gt; &lt;NULL&gt;      
# ℹ 31 more rows</code></pre>
</div>
</div>
<p>The result isn’t perfect, but it’ll do for our purposes - namely, to have a quick reference for the variables in our dataset.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Save the final (for now) data dictionary in a new object, <code>mil_dict</code>, so we can refer to it as needed.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mil_dict <span class="ot">&lt;-</span> mil_data <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  labelled<span class="sc">::</span><span class="fu">generate_dictionary</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_wider_delim</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> label,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">" - "</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"item_label"</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_few =</span> <span class="st">"align_start"</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="labelled-data" class="level2">
<h2 class="anchored" data-anchor-id="labelled-data">Labelled Data</h2>
<p>As we’ve just seen in the data dictionary, the SAV data we’re using has a special property: labels. Labelled data has a number of features, all of which we will explore in depth shortly:</p>
<ul>
<li><p><a href="10_qtrics.qmd#variable-labels"><strong>Variable labels</strong></a>. The label associated with a whole variable will contain the text of the item that the participants responded to. This is analogous to the “Label” column of the Variable View in SPSS.</p></li>
<li><p><a href="10_qtrics.qmd#value-labels"><strong>Value labels</strong></a>. The label associated with individual values within a variable will contain the text associated with individual choices, for instance the points on a Likert scale or the options on a multiple-choice question. This is analogous to the “Values” column of the Variable View in SPSS.</p></li>
<li><p><a href="10_qtrics.qmd#missing-values"><strong>Missing values</strong></a>. Within value labels, you can designate particular values as indicative of missing responses, refusal to respond, etc. This is analogous to the “Missing” column of the Variable View in SPSS.</p></li>
</ul>
<p>We’re first going to look at how you can work with each of these elements. The reason to do this is that once our dataset has been thoroughly checked, we’re going to generate a final data dictionary, then convert any categorical variables into factors, the levels of which will correspond to the labels for that variable. We’ll also convert any numeric variables into numeric data type, which will discard the labels; that will make it possible to do analyses with them, but that’s why we have to create the data dictionary first.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>These features will work optimally <em>only</em> if you have set up your Qualtrics questionnaire appropriately. Make sure to refer to the <a href="11_faq.qmd#setting-up-qualtrics">Setting Up Qualtrics</a> section of the next tutorial to get the most out of your labelled data and save yourself data cleaning and wrangling headaches later.</p>
</div>
</div>
<section id="variable-labels" class="level3">
<h3 class="anchored" data-anchor-id="variable-labels">Variable Labels</h3>
<p>Variable labels contain information about the whole variable, and for Qualtrics data, will by default contain either an automatically generated Qualtrics value (like “Start Date”), or the question text that that variable contains the responses to.</p>
<section id="getting-labels" class="level4">
<h4 class="anchored" data-anchor-id="getting-labels">Getting Labels</h4>
<p>To begin, let’s just get out a single variable label to work with using <code>labelled::var_label()</code>.</p>
<p>To specify the variable we want, we will need to subset it from the dataset, using either <code>$</code> or <code>dplyr::pull()</code> as previously.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(mil_data<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "What is your gender identity?\n\nThis question is optional. - Selected Choice"</code></pre>
</div>
</div>
</section>
<section id="creatingupdating-labels" class="level4">
<h4 class="anchored" data-anchor-id="creatingupdating-labels">Creating/Updating Labels</h4>
<p>If you’d like to edit labels, you can do it manually:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(mil_data<span class="sc">$</span>StartDate) <span class="ot">&lt;-</span> <span class="st">"Date and time questionnaire was started"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(mil_data<span class="sc">$</span>StartDate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date and time questionnaire was started"</code></pre>
</div>
</div>
<p>However, I’d recommend using it as an opportunity to start working with regular expressions. For example, if we want to keep only the first bit of the label for <code>gender</code>, then we can keep everything only up to an including the question mark, and and re-assign that to the variable label.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(mil_data<span class="sc">$</span>gender) <span class="ot">&lt;-</span> labelled<span class="sc">::</span><span class="fu">var_label</span>(mil_data<span class="sc">$</span>gender) <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"(.*</span><span class="sc">\\</span><span class="st">?).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x =</span> _)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(mil_data<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "What is your gender identity?"</code></pre>
</div>
</div>
</section>
<section id="searching-labels" class="level4">
<h4 class="anchored" data-anchor-id="searching-labels">Searching Labels</h4>
<p>A <em>very</em> nifty feature of variable labels and {labelled} is the ability to search through them with <code>labelled::look_for()</code>. With the whole dataset, <code>look_for()</code> returns essentially the same info as <code>generate_dictionary()</code>, but given a second argument with a search term, you get back only the variables whose label contains that term.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>labelled::look_for()</code> to get only the items that mentioned family.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I’ve piped into <code>tibble::as_tibble()</code> to make the output easier to read.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">look_for</span>(mil_data, <span class="st">"family"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
    pos variable     label                  col_type missing levels value_labels
  &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;                  &lt;chr&gt;      &lt;int&gt; &lt;name&gt; &lt;named list&gt;
1    31 belonging_2  Please rate the exten… dbl+lbl       15 &lt;NULL&gt; &lt;dbl [7]&gt;   
2    41 belonging_12 Please rate the exten… dbl+lbl       17 &lt;NULL&gt; &lt;dbl [7]&gt;   </code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="value-labels" class="level3">
<h3 class="anchored" data-anchor-id="value-labels">Value Labels</h3>
<p>Value labels contain individual labels associated with unique values within a variable. It’s not necessary to have a label for every value, and indeed sometimes it’s advantageous not to.</p>
<section id="getting-labels-1" class="level4">
<h4 class="anchored" data-anchor-id="getting-labels-1">Getting Labels</h4>
<p>There are two functions to assist with this. <code>labelled::val_labels()</code> (with an “s”) returns all of the labels, while <code>labelled::val_label()</code> (without an “s”) will return the label for a single value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">val_labels</span>(mil_data<span class="sc">$</span>english_fluency_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;labelled&lt;double&gt;[164]&gt;: Please select which box best describes your English fluency. - How well can you speak English?
  [1] 2 2 2 1 1 1 2 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1
 [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 2 1 1 1 1 2 1 1 1
 [75] 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 2 1 1 1 1 1 1 2 2
[112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
[149] 1 1 1 1 1 1 1 1 1 2 1 1 1 1 3 2

Labels:
 value      label
     1  Very well
     2       Well
     3   Not well
     4 Not at all</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">val_label</span>(mil_data<span class="sc">$</span>english_fluency_1, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Not well"</code></pre>
</div>
</div>
</section>
<section id="creatingupdating-labels-1" class="level4">
<h4 class="anchored" data-anchor-id="creatingupdating-labels-1">Creating/Updating Labels</h4>
<p>These two functions can also be used to update an entire variable or a single value respectively.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Get all the value labels for the <code>gender</code> variable. Then, update the last value to “Other”.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">val_labels</span>(mil_data<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;labelled&lt;double&gt;[164]&gt;: What is your gender identity?
  [1]  1  1  1  1  2  0  1  0  1 NA  1  1  1  1  0  1  1 NA  1  0  1  0  1  1  1
 [26]  1  1  0  0  1  1 NA  1  1  1  1  1 NA  0  1  0  2  1  0 NA  1  1  1  1 NA
 [51]  3 NA NA  1 NA  1  1  2  0  1  1  1  1 NA  1  1  0 NA  1  1  0  0  0  1  1
 [76]  1  1  1  1  1  1  1 NA  1  1  1  1  1  1  1  1  1  1  0  1 NA NA  1  1 NA
[101]  1  1  0  1  0  1 NA  1  1 NA NA  1  1  1 NA  1  1  0  1  1  1  1  0  0 NA
[126]  1  1  0  1 NA  1  1  1  1  0  1  1  0  1  1  1  1  1  1  0  0  1  1 NA  1
[151] NA  1  0  1  1  0  2  1 NA  0  0  1 NA  1

Labels:
 value                      label
     0                       Male
     1                     Female
     2                 Non-binary
     3 Other (please state below)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">val_label</span>(mil_data<span class="sc">$</span>gender, <span class="dv">3</span>) <span class="ot">&lt;-</span> <span class="st">"Other"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="missing-values" class="level3">
<h3 class="anchored" data-anchor-id="missing-values">Missing Values</h3>
<p>Labelled data allows an extra functionality from SPSS, namely to create user-defined “missing” values. These missing values aren’t <em>actually</em> missing, in the sense that the participant didn’t respond at all. Rather, they might be missing in the sense that a participant selected an option like “don’t know”, “doesn’t apply”, “prefer not to say”, etc.</p>
<p>Let’s look at an example. As we’ve just seen, we can get out all the value labels in variable with <code>labelled::val_labels()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">val_labels</span>(mil_data<span class="sc">$</span>english_fluency_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Very well       Well   Not well Not at all 
         1          2          3          4 </code></pre>
</div>
</div>
<p>This variable asked participants to indicate their level of English fluency. Even for participants who have in fact responded to this question, we may want to code “Not well” and “Not as all” as “missing” so that they can be excluded easily. To do this, we can use the function <code>labelled::na_values()</code> to indicate which values should be considered as missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">na_values</span>(mil_data<span class="sc">$</span>english_fluency_1) <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>mil_data<span class="sc">$</span>english_fluency_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;labelled_spss&lt;double&gt;[164]&gt;: Please select which box best describes your English fluency. - How well can you speak English?
  [1] 2 2 2 1 1 1 2 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1
 [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 2 1 1 1 1 2 1 1 1
 [75] 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 2 1 1 1 1 1 1 2 2
[112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
[149] 1 1 1 1 1 1 1 1 1 2 1 1 1 1 3 2
Missing values: 3, 4

Labels:
 value      label
     1  Very well
     2       Well
     3   Not well
     4 Not at all</code></pre>
</div>
</div>
<p>For the moment, these values are not actually <code>NA</code> in the data - they’re listed under “Missing Values” in the variable attributes. In other words, the actual responses are still retained. However, if we ask R which of the values in this variable are missing…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(mil_data<span class="sc">$</span>english_fluency_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [73] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [85] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [97] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[109] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[121] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[133] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[145] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[157] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE</code></pre>
</div>
</div>
<p>…we can see one <code>TRUE</code> corresponding to the 3 above.</p>
<p>If we wanted to actually remove those values entirely and turn them into <code>NA</code>s for real, we could use <code>labelled::user_na_to_na()</code> for that purpose. Now, the variable has only two remaining values, and any 3s and 4s have been replaced.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">user_na_to_na</span>(mil_data<span class="sc">$</span>english_fluency_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;labelled&lt;double&gt;[164]&gt;: Please select which box best describes your English fluency. - How well can you speak English?
  [1]  2  2  2  1  1  1  2  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
 [26]  1  1  1  1  1  1  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
 [51]  1  1  2  1  1  1  1  1  1  1  1  2  1  1  1  2  1  1  1  1  2  1  1  1  1
 [76]  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  2  1
[101]  1  1  2  1  1  1  1  1  1  2  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1
[126]  1  1  1  2  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
[151]  1  1  1  1  1  1  1  2  1  1  1  1 NA  2

Labels:
 value     label
     1 Very well
     2      Well</code></pre>
</div>
</div>
<p>::: callout-tip</p>
<p>See the <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">{labelled} vignette</a> for more help on working with user-defined NAs, including how to deal with them when converting to other types.</p>
</section>
</section>
<section id="converting-variables" class="level2">
<h2 class="anchored" data-anchor-id="converting-variables">Converting Variables</h2>
<p>The labels have served their purpose helping us navigate and clean up the dataset, and produce a lovely data dictionary for sharing. However, if we want to <em>use</em> the data, we’ll need to convert to other data types that we can use for statistical analysis.</p>
<p>This will fall into two main categories. Any variables containing numbers that we want to do maths with, we’ll convert to numeric type, which we’ve encountered a few times before, which will strip the labels. However, any variables that contain categorical data, we’ll instead convert to factors, which we haven’t encountered in this series yet - so we’ll start there. Remember that variables that will be converted to factor should have labels for all of their levels, whereas variables that will be converted to numeric can have fewer labels, because we will stop using them after the numeric conversion.</p>
<section id="factor" class="level3">
<h3 class="anchored" data-anchor-id="factor">Factor</h3>
<p>Factor variables are R’s way of representing categorical data, which have a fixed and known set of possible values. Thus far we’ve mostly been using character data for this purpose, but that’s a bit of a cheat - R’s been helping us by treating the same values as the same category, but factors create this structure explicitly.</p>
<p>As may be familiar from SPSS, factors actually contain two pieces of information for each observation: <em>levels</em> and <em>labels</em>. Levels are the (existing or possible) values that the variable contains, whereas labels are <em>very</em> similar to the labels we’ve just been exploring.</p>
<p>As an example, take an example factor vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Male   Female Male   Male   Female
Levels: Male Female</code></pre>
</div>
</div>
<p>The underlying values in the factor are numbers, here 1 and 2. The labels are applied to the values in ascending order of those values, so 1 becomes “Male”, “2” becomes “Female”, etc. Here, we haven’t need to specify the levels; if you don’t elaborate otherwise, R will assume that they are the same as the unique values.</p>
<p>You can also supply additional possible values, even if they haven’t been observed, using the <code>levels</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Non-binary"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Male   Female Male   Male   Male  
Levels: Male Female Non-binary</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Factors are so common and useful in R that they have a whole {tidyverse} package to themselves! You already installed {forcats} with {tidyverse}, but you can <a href="https://forcats.tidyverse.org/">check out the help documentation</a> if you’d like to learn more about working with factors.</p>
</div>
</div>
<p>The useful thing about labelled data that it’s very easy to convert into factors, which is what R expects for many different types of analysis and plotting functions. Handy!</p>
<p>For an individual variable, we can use <code>labelled::to_factor()</code> to convert to factor. Let’s compare before and after:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_fct =</span> labelled<span class="sc">::</span><span class="fu">to_factor</span>(gender),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 164 × 2
   gender          gender_fct
   &lt;dbl+lbl&gt;       &lt;fct&gt;     
 1  1 [Female]     Female    
 2  1 [Female]     Female    
 3  1 [Female]     Female    
 4  1 [Female]     Female    
 5  2 [Non-binary] Non-binary
 6  0 [Male]       Male      
 7  1 [Female]     Female    
 8  0 [Male]       Male      
 9  1 [Female]     Female    
10 NA              &lt;NA&gt;      
# ℹ 154 more rows</code></pre>
</div>
</div>
<p>If you wanted a specific order of the levels, for plotting or similar, there’s also a <code>sort_levels =</code> argument described in the help documentation.</p>
</section>
<section id="numeric" class="level3">
<h3 class="anchored" data-anchor-id="numeric">Numeric</h3>
<p>For continuous variables, we don’t need anything fancy to turn them into numeric data, because they technically already are. Instead, we just need to get rid of the labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">belonging_1_num =</span> <span class="fu">unclass</span>(belonging_1),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">belonging_1_lab =</span> labelled<span class="sc">::</span><span class="fu">labelled</span>(belonging_1_num),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 164 × 3
   belonging_1                    belonging_1_num belonging_1_lab
   &lt;dbl+lbl&gt;                                &lt;dbl&gt; &lt;dbl+lbl&gt;      
 1 6 [Agree]                                    6 6              
 2 4 [Neither Agree nor Disagree]               4 4              
 3 7 [Strongly agree]                           7 7              
 4 2 [Disagree]                                 2 2              
 5 6 [Agree]                                    6 6              
 6 5 [Somewhat agree]                           5 5              
 7 5 [Somewhat agree]                           5 5              
 8 2 [Disagree]                                 2 2              
 9 6 [Agree]                                    6 6              
10 5 [Somewhat agree]                           5 5              
# ℹ 154 more rows</code></pre>
</div>
</div>
<p>The nice thing about this method is that we can now do maths with the unclassed numeric functions as normal, but the labels are still there if we want to get back - just convert with <code>labelled::labelled()</code>.</p>
</section>
<section id="conditional-conversion" class="level3">
<h3 class="anchored" data-anchor-id="conditional-conversion">Conditional Conversion</h3>
<p>Back up when we went over <a href="10_qtics.qmd#the-plan">the plan</a>, I quoted a bit from the {labelled} intro vignette. Here’s the same info in a bit more detail:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In most of cases, if data documentation was properly done, categorical variables corresponds to vectors where all observed values have a value label while vectors where only few values have a value label should be considered as continuous.</p>
<p>In that situation, you could apply the <code>unlabelled()</code> method to an overall data frame. By default, <code>unlabelled()</code> works as follows:</p>
<ul>
<li>if a column doesn’t inherit the <code>haven_labelled</code> class, it will be not affected;</li>
<li>if all observed values have a corresponding value label, the column will be converted into a factor (using <code>to_factor()</code>);</li>
<li>otherwise, the column will be unclassed (and converted back to a numeric or character vector by applying <code>base::unclass()</code>).</li>
</ul>
</div>
</div>
<p>If we wanted to do this, we’d have a bit more work to do. That’s because at the moment, our data doesn’t line up with this template. Having a look at our data dictionary again, we can see that our subscale variables have all of their levels labelled, so they won’t be converted as we’d like. Rather than do this now, I’d probably recommend setting up your Qualtrics like this to begin with.</p>
<p>Instead, we can use what we’ve seen in previous Challenge tasks to convert variables conditionally.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Exercise">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>CHALLENGE</strong>: Convert categorical variables with labels to factors, and subscale variables to numeric.</p>
<p><em>Hint</em>: Have a look back at <code>dplyr::across()</code> for efficient selecting and applying.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mil_data <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(global_meaning_1<span class="sc">:</span><span class="fu">last_col</span>(),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>           unclass),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(english_fluency_1, gender),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>           labelled<span class="sc">::</span>to_factor)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>That’s about all we’ve got for today, although it’s a lot! You should now have a data dictionary to refer to, and a complete dataset to work with using the techniques we’ve already covered to clean up responses, create subscales, and so on. Next time we’ll work on solving common issues and avoiding those issues in the first place by setting things up right to begin with.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>